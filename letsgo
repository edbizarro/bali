#!/bin/bash

clear

echo "  Ensure keys are up to date..."
sudo pacman-key --refresh-keys &> /dev/null

echo "  Update the system..."
sudo pacman -Syy &> /dev/null

echo "  Installing Yaourt..."
pacman -Syy --noconfirm yaourt &> /dev/null

echo "  Updating the AUR packages..."
yaourt -Syuu --noconfirm &> /dev/null

echo "  DateTime..."
yaourt -Syuu --noconfirm  ntp &> /dev/null
sudo systemctl enable ntpd.service &> /dev/null
sudo ln -sfv /usr/share/zoneinfo/America/Sao_Paulo /etc/localtime

echo "  Connectivity shit..."
WIRELESS_DEV=$(ip link | grep wlp | awk '{print $2}'| sed 's/://' | sed '1!d')
if [[ -n $WIRELESS_DEV ]]; then
    echo "==> ${WIRELESS_DEV} interface detected"
    echo "  Installing wifi packages..."
    yaourt -S --noconfirm iw wireless_tools wpa_actiond wpa_supplicant dialog netctl vnstat &> /dev/null
fi

WIRED_DEV=$(ip link | grep "en[sop]" | awk '{print $2}'| sed 's/://' | sed '1!d')
if [[ -n $WIRED_DEV ]]; then
    echo "==> ${WIRED_DEV} interface detected"
    sudo systemctl enable dhcpcd@${WIRED_DEV}.service
fi

if ! grep "^noarp$" /etc/dhcpcd.conf; then
    echo -e "\nnoarp" | sudo tee -a /etc/dhcpcd.conf
fi

echo "  Installing terminal stuff..."
yaourt -S --noconfirm gotop-bin zsh htop iotop rxvt-unicode-pixbuf tmux neovim stow ncdu slurm &> /dev/null

echo "  Installing dev stuff"
yaourt -S --noconfirm pyenv pyenv-virtualenv nodejs yarn npm dockerfile-language-server-bin php-language-server bash-language-server python-language-server vue-language-server visual-studio-code-bin atom apm jetbrains-toolbox docker docker-compose &> /dev/null
apm install busy-signal atom-ide-signature-help atom-ide-markdown-service terraform-fmt ide-bash ide-docker ide-vue ide-css ide-json atom-ide-ui language-vue ide-yaml atom-ide-datatip atom-ide-definitions ide-php atom-ide-signature-help atom-material-syntax-dark pigments file-icons styri-syntax duotone-dark-sky-syntax pristine-ui emmet atom-beautify git-blame project-manager highlight-selected minimap &> /dev/null

echo "  Installing productivity tools"
yaourt -S --noconfirm zip unzip unrar p7zip libreoffice-fresh pcloud-drive boostnote &> /dev/null

echo "  Installing ricing shit..."
yaourt -S --noconfirm polybar compton scrot feh python-pywal i3-gaps dunst rofi unclutter betterlockscreen  &> /dev/null

echo "     ...fonts "
yaourt -S --noconfirm tamzen-font nerd-fonts-complete ttf-iosevka  &> /dev/null

echo "  Installing display drivers & tools..."
yaourt -S --noconfirm bumblebee mesa xf86-video-intel nvidia lib32-nvidia-utils lib32-virtualgl nvidia-settings bbswitch mons  &> /dev/null

# https://wiki.archlinux.org/index.php/fan_speed_control#Fancontrol_(lm-sensors)
echo "  Temp CÂº..."
yaourt -S --noconfirm i8kutils tcl tk acpi dell-bios-fan-control-git &> /dev/null


echo "  Installing music & audio manager..."
yaourt -S --noconfirm mpv cava alsa-utils alsa-lib mopidy-git mopidy-spotify mopidy-scrobbler ncmpcpp mopidy-spotify-tunigo lyvi-git &> /dev/null

echo "  Installing the battery manager..."
yaourt -S --noconfirm powertop tlp &> /dev/null

echo "  Installing touchpad packages..."
yaourt -S --noconfirm xf86-input-synaptics xf86-input-libinput &> /dev/null
